---
title: "Let's Talk About Sex"
author: "Max Bartlett, Jennifer Chin, and Liam Pulsifer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: github_document
---

```{r setup, include=FALSE}
require(knitr)
opts_chunk$set(echo = FALSE)
```

```{r load-packages, echo = FALSE, include = FALSE}
library(tidyverse)
library(infer)
```

```{r read-data, echo = FALSE, include = FALSE}
setwd("/cloud/project")
sex_survey <- read_csv("data/SexSurvey_tidy.csv")
```

##Introduction
###Description of Data

For our final project, we wanted to analyze the number of sexual partners that college students, primarily those at Duke, have had and whether or not that number correlates to a range of demographic factors, such as religion, year in school, or political views. We collected our own data for this project using a Qualtrics survey. This survey was relatively short and had 14 questions. The results of these questions are stored in the variables below:

  1. `student`: Are you a college student?
  2. `college`: Which college do you go to?
  3. `year`: Which year in college are you?
  4. `age`: What is your age?
  5. `gender`: What is your gender?
  6. `major`: What is your major?
  7. `athlete`: Are you a student athlete?
  8. `greek`: Are you involved in a fraternity or sorority?
  9. `politics`: How would you describe your political views? (There were 5 options for this question: Very Conservative, Somewhat Conservative, Neither, Somewhat Liberal, and Very Liberal)
  10. `religious`: Would you consider yourself to be religious?
  11. `religion`: If so, which religion do you practice?
  12. `partners`: In your life, how many sexual partners have you had?
  13. `partners`: Since coming to college, how many sexual partners have you had?
  14. `relationship`: Are you currently in a committed romantic relationship that has lasted longer than 1 month?

To get answers to our survey, we asked our friends to fill it out and also posted the survey in the All Duke Facebook group and the class Slack channel. We received 394 submissions in less than 2 days. After poring over the responses, we removed ones with no answers filled in and ones that were evidently bogus, and were left with `r nrow(sex_survey)` observations. Additionally, we split the `major` column into `major_one` and `major_two` to account for people who listed two majors. 

##Research Question

  Our research question is "Which demographic factors are most strongly associated with number of sexual partners in college students?" To answer this question using the data we collected (described above), we first need to clean the data and remove some unnecessary variables and observations.

```{r clean-data}

sex_survey <- sex_survey %>%
  filter(student == "Yes" & college == "Duke University") %>%
  select(-ip_address, -duration, -location_latitude, -location_longitude, -student, -college)%>%
  mutate(majcount = if_else(!is.na(major_one) & !is.na(major_two), 2, 1))

```

We chose to filter the data for students at Duke because we didn't get enough responses from non-Duke students to do any meaningful analysis. We also chose to remove some variables, such as ip_address from which the survey was taken, which we deemed extraneous.


```{r summary-stats}

sex_survey %>%
  filter(!is.na(partners))%>%
  summarize(max = max(partners),
            min = min(partners),
            mean = mean(partners),
            median = median(partners),
            sd = sd(partners),
            q1 = quantile(partners, .25),
            q3 = quantile(partners, .75),
            num = n()
            )%>%
  show()
sex_survey %>%
  filter(!is.na(partners_college))%>%
  summarize(max = max(partners_college),
            min = min(partners_college),
            mean = mean(partners_college),
            median = median(partners_college),
            sd = sd(partners_college),
            q1 = quantile(partners_college, .25),
            q3 = quantile(partners_college, .75),
            num = n()
            )%>%
  show()

sex_survey %>%
  filter(!is.na(partners))%>%
  ggplot(aes(x = 1, y = partners)) +
    geom_boxplot()

```

```{r by-major}

sex_survey %>%
  group_by(major_one)%>%
  filter(!is.na(partners) & !is.na(major_one))%>%
  summarize(max = max(partners),
            min = min(partners),
            mean = mean(partners),
            median = median(partners),
            sd = sd(partners),
            q1 = quantile(partners, .25),
            q3 = quantile(partners, .75),
            num = n()
            )%>%
  filter(num > 10)%>%
  arrange(desc(mean))%>%
  show()

```


```{r by-major-plots}

sex_survey %>%
  group_by(major_one)%>%
  filter(!is.na(partners) & !is.na(major_one))%>%
  filter(n() > 10)%>%
  ggplot(aes(x = major_one, y = partners)) +
    geom_boxplot(varwidth = TRUE) +
    coord_flip()

```

```{r by-year} 

sex_survey %>%
  group_by(year)%>%
  filter(!is.na(partners) & !is.na(year))%>%
  summarize(max = max(partners),
            min = min(partners),
            mean = mean(partners),
            median = median(partners),
            sd = sd(partners),
            q1 = quantile(partners, .25),
            q3 = quantile(partners, .75),
            num = n()
            )%>%
  filter(num > 10)%>%
  arrange(mean)%>%
  show()

sex_survey %>%
  filter(!is.na(partners) & !is.na(year) & !is.na(relationship))%>%
  mutate(year = factor(year, c("Freshman", "Sophomore", "Junior", "Senior")))%>%
  group_by(year)%>%
  ggplot(aes(x = year, y = partners, fill = relationship)) +
    geom_bar(stat = "summary", position = "dodge", fun.y = "mean")

```

##Conclusion/Discussion (1-2 pgs)

###Critiques/Suggestions for Improvement
##### Issues pertaining to the reliability and validity of your data, and appropriateness of the statistical analysis should be discussed here.

##### A paragraph on what you would do differently if you were able to start over with the project or what you would do next if you were going to continue work on the project should also be included.

Because our survey was voluntary and taken primarily by Duke students and people we know, we are aware that our data may be skewed and not necessarily completely representative. In other words, our data is definitely subject to voluntary response bias. **add more**